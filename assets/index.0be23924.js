var K=Object.defineProperty,Z=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var H=(r,e,t)=>e in r?K(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,y=(r,e)=>{for(var t in e||(e={}))D.call(e,t)&&H(r,t,e[t]);if(N)for(var t of N(e))P.call(e,t)&&H(r,t,e[t]);return r},U=(r,e)=>Z(r,q(e));var O=(r,e)=>{var t={};for(var s in r)D.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&N)for(var s of N(r))e.indexOf(s)<0&&P.call(r,s)&&(t[s]=r[s]);return t};import{c as I,a as d,i as M,u as R,j as A,b as _,r as f,d as Y,e as J,p as Q,T as X,y as ee,B as te,H as re,f as p,g as w,h as b,k,l as oe,s as se,m as ne,n as ae,o as ie,C as ce,V as le,A as de,q as ue,O as me,R as pe}from"./vendor.d4edacc0.js";const he=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}};he();const ge=I({id:"computer",initial:"running",context:{cpu:{harvester:0,soldier:0,defender:0},gpu:{harvester:0,soldier:0,defender:0},ram:{harvester:0,soldier:0,defender:0},ssd:{harvester:0,soldier:0,defender:0},psu:{harvester:0,soldier:0,defender:0}},states:{running:{on:{SEND_UNIT:{actions:"updateUnit"},RECALL_UNIT:{actions:"updateUnit"},KILL_UNIT:{actions:"updateUnit"}}}}},{actions:{updateUnit:d((r,e)=>{const{part:t,unit:s}=e,n=e.type==="SEND_UNIT"?1:-1;return{[t]:U(y({},r[t]),{[s]:r[t][s]+n})}})}}),S=M(ge);S.start();const l={minInterval:.1,interval:.5,cooldown:7,maxHarvester:10,maxSoldier:10,ssdHarvesterBonus:3,cpuHarvesterLimiter:.01,psuHarvesterLimiter:.05},T={harvester:5,soldier:10},F=r=>Number.parseFloat(r.toFixed(2)),ve=I({id:"player",initial:"idle",context:{elapsed:0,elapsedCooldown:{harvester:0,soldier:0},interval:0,cooldown:0,maxHarvester:0,maxSoldier:0,energy:0,harvester:0,soldier:0},states:{idle:{on:{START:{actions:"start",target:"running"}}},running:{invoke:{src:"tick"},on:{TICK:{actions:"process",target:"running"},CHANGE_SPEED:{actions:"changeSpeed"},BUILD_UNIT:{actions:"buildUnit",cond:"hasEnergyForUnit"},SEND_UNIT:{actions:"sendUnit",cond:"hasUnit"},RECALL_UNIT:{actions:"recallUnit",cond:"hasSentUnit"}}}}},{guards:{hasEnergyForUnit:(r,e)=>e.type==="BUILD_UNIT"&&r.energy>=T[e.unit],hasUnit:(r,e)=>e.type==="SEND_UNIT"&&r[e.unit]>0,hasSentUnit:(r,e)=>e.type==="RECALL_UNIT"&&S.state.context[e.part][e.unit]>=1},services:{tick:(r,e)=>t=>{const{interval:s}=r,n=setTimeout(t,1e3*s,"TICK");return()=>clearTimeout(n)}},actions:{start:d((r,e)=>e.type!=="START"?{}:y({elapsed:0,elapsedCooldown:0,interval:l.interval,cooldown:l.cooldown,maxHarvester:l.maxHarvester,maxSoldier:l.maxSoldier},e.resources)),process:d((r,e)=>{const{cpu:t,gpu:s,ram:n,ssd:a,psu:c}=S.state.context,u=-(t.harvester*l.cpuHarvesterLimiter),v=-(1+n.harvester/2),G=c.harvester*l.psuHarvesterLimiter,z=a.harvester*l.ssdHarvesterBonus;return{elapsed:r.elapsed+1,interval:Math.max(l.minInterval,l.interval+u),cooldown:l.cooldown,energy:F(r.energy+G),maxHarvester:l.maxHarvester+z,maxSoldier:l.maxHarvester+z,elapsedCooldown:{harvester:Math.max(0,r.elapsedCooldown.harvester+v),soldier:Math.max(0,r.elapsedCooldown.soldier+v)}}}),changeSpeed:d((r,e)=>e.type!=="CHANGE_SPEED"?{}:{interval:r.interval+e.amount}),buildUnit:d((r,e)=>{if(e.type!=="BUILD_UNIT")return{};const{unit:t}=e;return{energy:F(r.energy-T[t]),[t]:r[t]+1}}),sendUnit:d((r,e)=>{if(e.type!=="SEND_UNIT")return{};const{unit:t,part:s}=e;return S.send({type:"SEND_UNIT",unit:t,part:s}),{[t]:r[t]-1,elapsedCooldown:U(y({},r.elapsedCooldown),{[t]:l.cooldown})}}),recallUnit:d((r,e)=>{if(e.type!=="RECALL_UNIT")return{};const{unit:t,part:s}=e;return S.send({type:"RECALL_UNIT",unit:t,part:s}),{[t]:r[t]+1,elapsedCooldown:U(y({},r.elapsedCooldown),{[t]:l.cooldown})}})}}),m=M(ve);m.start();const ye=I({id:"game",initial:"idle",context:{viewedModule:null},states:{idle:{on:{START:{target:"running",actions:"start"},RESUME:{target:"running",actions:"resume"}}},running:{on:{PAUSE:"paused",END_GAME:"ended",VIEW_MODULE:{actions:"setViewedModule"}}},paused:{on:{START:"running"}},ended:{on:{RESET:{target:"idle",actions:"reset"}}}}},{actions:{start:d((r,e)=>e.type!=="START"?{}:(m.send({type:"START",resources:e.resources}),{})),reset:d((r,e)=>e.type!=="END_GAME"?{}:(m.send({type:"START",resources:{energy:0,harvester:0,soldier:0}}),{viewedModule:null})),setViewedModule:d((r,e)=>e.type!=="VIEW_MODULE"?{}:{viewedModule:e.module})}}),B=M(ye);B.start();const h=()=>R(B),$=()=>R(m),o=A.exports.jsx,i=A.exports.jsxs,V=A.exports.Fragment,fe=()=>{var s;const[r]=$(),{context:e}=r;let t=e.energy.toString();return t.split(".").length===1?t=`${t}.00`:((s=t.split(".").pop())==null?void 0:s.length)===1&&(t=`${t}0`),i("div",{className:"p-2",children:[i("p",{children:["elapsed: ",e.elapsed]}),i("p",{children:["interval: ",e.interval]}),o("h4",{children:"resources"}),i("p",{children:["energy: ",t]}),i("p",{children:["harvesters: ",e.harvester," / ",e.maxHarvester]}),i("p",{children:["soldiers: ",e.soldier," / ",e.maxSoldier]})]})},L=({label:r,onClick:e,className:t,disabled:s=!1})=>o("button",{onClick:e,type:"button",className:_("px-2 py-1 border rounded disabled:opacity-50 disabled:cursor-auto",t),disabled:s,children:r}),we=()=>{const[r,e]=h();return f.exports.useEffect(()=>{e({type:"START",resources:{energy:10,harvester:5,soldier:5}})},[]),i("div",{className:_("absolute inset-0 pointer-events-none h-full w-full z-10 flex flex-col justify-between items-end","select-none text-white"),children:[o(fe,{}),i("div",{className:"p-2 pointer-events-auto",children:[o(L,{onClick:()=>e("PAUSE"),label:"pause"}),o(L,{onClick:()=>m.send({type:"BUILD_UNIT",unit:"harvester"}),label:`Build harvester (-${T.harvester})`}),o(L,{onClick:()=>m.send({type:"BUILD_UNIT",unit:"soldier"}),label:`Build soldier (-${T.soldier})`})]}),r.matches("ended")&&o("p",{children:"Ended"}),r.matches("paused")&&i("div",{className:_("absolute z-50 w-full h-full bg-black bg-opacity-30 backdrop-filter backdrop-blur-sm","grid place-content-center pointer-events-auto text-white"),children:[o("h2",{className:"uppercase text-8xl",children:"Paused"}),o(L,{onClick:()=>e("START"),label:"resume"})]})]})},be=()=>i(Y,{multisampling:8,children:[o(J,{intensity:.7,height:200,luminanceThreshold:.4,luminanceSmoothing:.9}),o(Q,{opacity:.06}),o(X,{eskil:!1,offset:0,darkness:1.3}),o(ee,{blendFunction:te.MULTIPLY,samples:30,rings:30,distanceThreshold:1,distanceFalloff:.1,rangeThreshold:1,rangeFalloff:.1,luminanceInfluence:.1,radius:2,scale:.2,bias:.035})]}),C=.1,x={mass:1,tension:1e3,friction:25,precision:1e-4},g=new URL("/game-off-2021/assets/computer.185dcdf2.glb",self.location).href,Se=()=>R(S),j=({onClick:r,label:e,className:t})=>o("button",{type:"button",className:`px-2 py-1 ${t}`,onClick:r,children:e}),W=({unit:r,part:e})=>{const[t,s]=$(),{elapsedCooldown:n,cooldown:a}=t.context,c=n[r]>0;return i("div",{className:"relative overflow-hidden border rounded border-white bg-opacity-50",children:[c&&o("div",{style:{transform:`scale(${1-n[r]/a}, 1)`},className:"absolute w-full h-full bg-white origin-left transition-transform duration-300"}),o(j,{className:_("icon-plus border-r border-white",{"invisible pointer-events-none":c}),onClick:()=>s({type:"SEND_UNIT",unit:r,part:e})}),o(j,{className:_("icon-minus",{"invisible pointer-events-none":c}),onClick:()=>s({type:"RECALL_UNIT",unit:r,part:e})})]})},E=({name:r,description:e})=>{const[,t]=h(),[s]=Se(),{harvester:n,soldier:a}=s.context[r];return i(re,{as:"div",distanceFactor:.5,zIndexRange:[10,0],sprite:!0,className:"text-white bg-gray-800 text-xs p-3 cursor-default select-none min-w-[12rem] rounded-md",children:[i("div",{className:"flex justify-between items-center",children:[o("h3",{className:"text-base",children:r}),o("button",{onClick:()=>t({type:"VIEW_MODULE",module:null}),className:"icon-x p-2"})]}),o("p",{className:"my-2",children:e}),i("div",{className:"flex items-center justify-between gap-1 my-1",children:[o("div",{children:"Harvesters"}),o("div",{children:n}),o(W,{unit:"harvester",part:r})]}),i("div",{className:"flex items-center justify-between gap-1 my-1",children:[o("div",{children:"Soldiers"}),o("div",{children:a}),o(W,{unit:"soldier",part:r})]})]})},xe=`
Causes additional energy to be redistributed to the virus.
`,Ue=()=>{const[r,e]=h(),t=r.context.viewedModule==="psu",{nodes:s}=p(g),[{z:n}]=w({z:t?C+.04:.04,config:x},[t]);return o(b.mesh,{name:"psu",castShadow:!0,onClick:a=>{a.stopPropagation(),e({type:"VIEW_MODULE",module:t?null:"psu"})},geometry:s.psu.geometry,material:s.psu.material,"position-x":.002,"position-y":.159,"position-z":n,children:t&&o(E,{name:"psu",description:xe})})},_e=`
Creates a greater chance every clock tick that a random unit will be generated.
`,Ce=()=>{const r=.061,[e,t]=h(),s=e.context.viewedModule==="gpu",{nodes:n,materials:a}=p(g),[{z:c}]=w({z:s?C+r:r,config:x},[s]),u=f.exports.useRef(null);return k(()=>{u.current.rotation.y+=.01+1/m.state.context.interval}),i(b.group,{name:"gpu",onClick:v=>{v.stopPropagation(),t({type:"VIEW_MODULE",module:s?null:"gpu"})},"position-x":.003,"position-y":-.076,"position-z":c,children:[o("mesh",{castShadow:!0,geometry:n.Cube002.geometry,material:n.Cube002.material}),o("mesh",{castShadow:!0,geometry:n.Cube002_1.geometry,material:n.Cube002_1.material}),o("mesh",{castShadow:!0,geometry:n.Cube002_2.geometry,material:n.Cube002_2.material}),o("mesh",{castShadow:!0,name:"gpu-fan",ref:u,geometry:n.gpu_fan.geometry,material:a.light_metal,position:[.0675,.015,.001]}),s&&o(E,{name:"gpu",description:_e})]})},Ee=`
Speeds up the game clock for the virus.
`,Ne=()=>{const[r,e]=h(),t=r.context.viewedModule==="cpu",{nodes:s,materials:n}=p(g),[{z:a}]=w({z:t?C+.037:.037,config:x},[t]),[{z:c}]=w({z:t?.06:.012,config:x},[t]),u=f.exports.useRef(null);return k(()=>{u.current.rotation.z+=.01+1/m.state.context.interval*.01}),i(V,{children:[o(b.mesh,{castShadow:!0,receiveShadow:!0,name:"cpu",geometry:s.cpu.geometry,material:s.cpu.material,"position-x":0,"position-y":0,"position-z":c}),i(b.group,{name:"cpu-cooler",onClick:v=>{v.stopPropagation(),e({type:"VIEW_MODULE",module:t?null:"cpu"})},"position-x":0,"position-y":0,"position-z":a,children:[o("mesh",{castShadow:!0,geometry:s.Cube011.geometry,material:s.Cube011.material}),o("mesh",{castShadow:!0,geometry:s.Cube011_1.geometry,material:n.sand}),o("mesh",{name:"cpu-fan",castShadow:!0,ref:u,geometry:s.cpu_fan.geometry,material:n.brown,position:[0,0,.01]}),t&&o(E,{name:"cpu",description:Ee})]})]})};var Te="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}",Le="uniform float time;varying vec2 vUv;void main(){vec3 rgb=0.5+0.5*cos(time+vUv.xyx+vec3(0,2,4));gl_FragColor=vec4(rgb,1.0);}";const Ie=se({time:0},Te,Le);oe({RamMaterial:Ie});const Me=`
Results in faster cooldowns when assigning units.
`,Re=()=>{const[r,e]=h(),t=r.context.viewedModule==="ram",{nodes:s,materials:n}=p(g),[{z:a}]=w({z:t?C+.047:.047,config:x},[t]),c=f.exports.useRef(null);return k(()=>c.current.uniforms.time.value+=.01),i(b.group,{onClick:u=>{u.stopPropagation(),e({type:"VIEW_MODULE",module:t?null:"ram"})},"position-x":.068,"position-y":.013,"position-z":a,children:[o("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.Cube009.geometry,material:s.Cube009.material}),o("mesh",{castShadow:!0,receiveShadow:!0,geometry:s.Cube009_1.geometry,material:s.Cube009_1.material}),o("mesh",{castShadow:!0,geometry:s.Cube009_2.geometry,material:n.red,children:o("ramMaterial",{ref:c,attach:"material",color:"hotpink"})}),t&&o(E,{name:"ram",description:Me})]})},Ae=`
allows additional units to be built.
`,ke=()=>{const[r,e]=h(),t=r.context.viewedModule==="ssd",{nodes:s}=p(g),[{z:n}]=w({z:t?C+.016:.016,config:x},[t]);return o(b.mesh,{name:"ssd",castShadow:!0,receiveShadow:!0,onClick:a=>{a.stopPropagation(),e({type:"VIEW_MODULE",module:t?null:"ssd"})},geometry:s.ssd.geometry,material:s.ssd.material,"position-x":0,"position-y":.062,"position-z":n,children:t&&o(E,{name:"ssd",description:Ae})})};p.preload(g);const ze=e=>{var r=O(e,[]);const{nodes:t,materials:s}=p(g);return i("group",U(y({},r),{dispose:null,children:[o("mesh",{name:"motherboard",receiveShadow:!0,geometry:t.motherboard.geometry,material:s.green}),o("mesh",{castShadow:!0,receiveShadow:!0,name:"io",geometry:t.io.geometry,material:t.io.material,position:[-.092,.014,.032]}),o("mesh",{castShadow:!0,receiveShadow:!0,name:"motherboard_gpu_io",geometry:t.motherboard_gpu_io.geometry,material:t.motherboard_gpu_io.material,position:[-.044,-.077,.009]}),o("mesh",{receiveShadow:!0,name:"motherboard_cpu_io",geometry:t.motherboard_cpu_io.geometry,material:s.white,position:[0,0,.005]}),o("mesh",{castShadow:!0,receiveShadow:!0,name:"ram_io",geometry:t.ram_io.geometry,material:t.ram_io.material,position:[.078,.013,.008]}),o(Ue,{}),o(Ce,{}),o(Re,{}),o(Ne,{}),o(ke,{})]}))};ne({frustum:1.75,size:.01,near:5.5,samples:30,rings:50});const De=()=>{const r=1,{tier:e,gpu:t}=ae(),s=e<2&&!/apple gpu/i.test(t!=null?t:"");return i(V,{children:[s&&o(ie,{}),o("ambientLight",{intensity:.1}),o("directionalLight",{intensity:.5,position:[2,2,20],color:"red"}),o("directionalLight",{castShadow:!0,position:[2,2,3],intensity:2,"shadow-mapSize-width":1024,"shadow-mapSize-height":1024,"shadow-camera-far":20,"shadow-camera-left":-r,"shadow-camera-right":r,"shadow-camera-top":r,"shadow-camera-bottom":-r,onUpdate:n=>n.lookAt(0,0,0)}),o("spotLight",{intensity:.5,position:[-5,10,2],angle:.2,penumbra:1,"shadow-mapSize":[2048,2048],onUpdate:n=>n.lookAt(0,0,0)}),o("rectAreaLight",{intensity:.5,position:[4.5,0,2],width:10,height:10})]})},Pe=()=>i("div",{className:"h-screen w-screen",children:[o(f.exports.Suspense,{fallback:null,children:i(ce,{shadows:!0,mode:"concurrent",performance:{min:.7},dpr:Math.min(2,window.devicePixelRatio),gl:{alpha:!1,antialias:!1},camera:{position:new le(-.25,.25,.25)},children:[o(de,{pixelated:!0}),o(ue,{}),o(be,{}),o(me,{enablePan:!1,enableZoom:!1,enableRotate:!0}),o(De,{}),o(ze,{})]})}),o(we,{})]});pe.render(o(f.exports.StrictMode,{children:o(Pe,{})}),document.getElementById("root"));
