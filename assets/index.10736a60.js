var j=Object.defineProperty,$=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var P=(r,e,t)=>e in r?j(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,N=(r,e)=>{for(var t in e||(e={}))k.call(e,t)&&P(r,t,e[t]);if(E)for(var t of E(e))z.call(e,t)&&P(r,t,e[t]);return r},I=(r,e)=>$(r,G(e));var H=(r,e)=>{var t={};for(var o in r)k.call(r,o)&&e.indexOf(o)<0&&(t[o]=r[o]);if(r!=null&&E)for(var o of E(r))e.indexOf(o)<0&&z.call(r,o)&&(t[o]=r[o]);return t};import{c as S,a as d,i as L,u as M,j as R,b as A,r as x,d as W,e as K,p as Z,T as q,y as Y,B as J,H as Q,f as p,g as y,h as v,k as D,l as X,s as ee,C as te,V as re,A as ne,O as oe,R as se}from"./vendor.2b42f53a.js";const ie=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}};ie();const ae=S({id:"computer",initial:"running",context:{cpu:{harvester:0,soldier:0,defender:0},gpu:{harvester:0,soldier:0,defender:0},ram:{harvester:0,soldier:0,defender:0},ssd:{harvester:0,soldier:0,defender:0},psu:{harvester:0,soldier:0,defender:0}},states:{running:{on:{SEND_UNIT:{actions:"updateUnit"},RECALL_UNIT:{actions:"updateUnit"},KILL_UNIT:{actions:"updateUnit"}}}}},{actions:{updateUnit:d((r,e)=>{const{part:t,unit:o}=e,s=e.type==="SEND_UNIT"?1:-1;return{[t]:I(N({},r[t]),{[o]:r[t][o]+s})}})}}),f=L(ae);f.start();const c={minInterval:.1,interval:.5,cooldown:7,maxHarvester:10,maxSoldier:10,ssdHarvesterBonus:3,cpuHarvesterLimiter:.01,psuHarvesterLimiter:.05},C={harvester:5,soldier:10},le=S({id:"player",initial:"idle",context:{elapsed:0,elapsedCooldown:0,interval:0,cooldown:0,maxHarvester:0,maxSoldier:0,energy:0,harvester:0,soldier:0},states:{idle:{on:{START:{actions:"start",target:"running"}}},running:{invoke:{src:"tick"},on:{TICK:{actions:"process",target:"running"},CHANGE_SPEED:{actions:"changeSpeed"},BUILD_UNIT:{actions:"buildUnit",cond:"hasEnergyForUnit"},SEND_UNIT:{actions:"sendUnit",cond:"hasUnit"},RECALL_UNIT:{actions:"recallUnit",cond:"hasSentUnit"}}}}},{guards:{hasEnergyForUnit:(r,e)=>e.type==="BUILD_UNIT"&&r.energy>=C[e.unit],hasUnit:(r,e)=>e.type==="SEND_UNIT"&&r[e.unit]>0,hasSentUnit:(r,e)=>e.type==="RECALL_UNIT"&&f.state.context[e.part][e.unit]>=1},services:{tick:(r,e)=>t=>{const{interval:o}=r,s=setTimeout(t,1e3*o,"TICK");return()=>clearTimeout(s)}},actions:{start:d((r,e)=>e.type!=="START"?{}:N({elapsed:0,elapsedCooldown:0,interval:c.interval,cooldown:c.cooldown,maxHarvester:c.maxHarvester,maxSoldier:c.maxSoldier},e.resources)),process:d((r,e)=>{const{cpu:t,gpu:o,ram:s,ssd:i,psu:l}=f.state.context;return{elapsed:r.elapsed+1,elapsedCooldown:Math.max(0,r.elapsedCooldown-1),interval:Math.max(c.minInterval,c.interval-t.harvester*c.cpuHarvesterLimiter),cooldown:c.cooldown,energy:Number.parseFloat((r.energy+l.harvester*c.psuHarvesterLimiter).toFixed(2)),maxHarvester:c.maxHarvester+i.harvester*c.ssdHarvesterBonus,maxSoldier:c.maxHarvester+i.harvester*c.ssdHarvesterBonus}}),changeSpeed:d((r,e)=>e.type!=="CHANGE_SPEED"?{}:{interval:r.interval+e.amount}),buildUnit:d((r,e)=>{if(e.type!=="BUILD_UNIT")return{};const{unit:t}=e;return{energy:r.energy-C[t],[t]:r[t]+1}}),sendUnit:d((r,e)=>{if(e.type!=="SEND_UNIT")return{};const{unit:t,part:o}=e;return f.send({type:"SEND_UNIT",unit:t,part:o}),{[t]:r[t]-1,elapsedCooldown:c.cooldown}}),recallUnit:d((r,e)=>{if(e.type!=="RECALL_UNIT")return{};const{unit:t,part:o}=e;return f.send({type:"RECALL_UNIT",unit:t,part:o}),{[t]:r[t]+1}})}}),u=L(le);u.start();const ce=S({id:"game",initial:"idle",context:{viewedModule:null},states:{idle:{on:{START:{target:"running",actions:"start"},RESUME:{target:"running",actions:"resume"}}},running:{on:{PAUSE:"paused",END_GAME:"ended",VIEW_MODULE:{actions:"setViewedModule"}}},paused:{on:{START:"running"}},ended:{on:{RESET:{target:"idle",actions:"reset"}}}}},{actions:{start:d((r,e)=>e.type!=="START"?{}:(u.send({type:"START",resources:e.resources}),{})),reset:d((r,e)=>e.type!=="END_GAME"?{}:(u.send({type:"START",resources:{energy:0,harvester:0,soldier:0}}),{viewedModule:null})),setViewedModule:d((r,e)=>e.type!=="VIEW_MODULE"?{}:{viewedModule:e.module})}}),O=L(ce);O.start();const h=()=>M(O),B=()=>M(u),n=R.exports.jsx,a=R.exports.jsxs,de=R.exports.Fragment,ue=()=>{const[r]=B(),{context:e}=r;return a("div",{className:"p-2",children:[a("p",{children:["elapsed: ",e.elapsed]}),a("p",{children:["interval: ",e.interval]}),n("h4",{children:"resources"}),a("p",{children:["energy: ",e.energy]}),a("p",{children:["harvesters: ",e.harvester," / ",e.maxHarvester]}),a("p",{children:["soldiers: ",e.soldier," / ",e.maxSoldier]})]})},T=({label:r,onClick:e,className:t,disabled:o=!1})=>n("button",{onClick:e,type:"button",className:A("px-2 py-1 border rounded disabled:opacity-50 disabled:cursor-auto",t),disabled:o,children:r}),me=()=>{const[r,e]=h();return x.exports.useEffect(()=>{e({type:"START",resources:{energy:10,harvester:5,soldier:5}})},[]),a("div",{className:"absolute inset-0 pointer-events-none h-full w-full z-10 flex flex-col justify-between items-end select-none",children:[n(ue,{}),a("div",{className:"p-2 pointer-events-auto",children:[n(T,{onClick:()=>e("PAUSE"),label:"pause"}),n(T,{onClick:()=>u.send({type:"BUILD_UNIT",unit:"harvester"}),label:`Build harvester (-${C.harvester})`}),n(T,{onClick:()=>u.send({type:"BUILD_UNIT",unit:"soldier"}),label:`Build soldier (-${C.soldier})`})]}),r.matches("ended")&&n("p",{children:"Ended"}),r.matches("paused")&&a("div",{className:"absolute z-50 w-full h-full bg-black bg-opacity-30 backdrop-filter backdrop-blur-sm grid place-content-center pointer-events-auto text-white",children:[n("h2",{className:"uppercase text-8xl",children:"Paused"}),n(T,{onClick:()=>e("START"),label:"resume"})]})]})},pe=()=>a(W,{children:[n(K,{intensity:.6,height:300,luminanceThreshold:.4,luminanceSmoothing:.9}),n(Z,{opacity:.1}),n(q,{eskil:!1,offset:.1,darkness:1.1}),n(Y,{blendFunction:J.MULTIPLY,samples:30,rings:4,distanceThreshold:1,distanceFalloff:0,rangeThreshold:.5,rangeFalloff:.1,luminanceInfluence:.9,radius:20,scale:.5,bias:.5})]}),_=.1,b={mass:1,tension:1e3,friction:25,precision:1e-4},g=new URL("/game-off-2021/assets/computer.185dcdf2.glb",self.location).href,he=()=>M(f),F=({onClick:r,label:e,className:t})=>n("button",{type:"button",className:`px-2 py-1 ${t}`,onClick:r,children:e});let ge=0;const V=({unit:r,part:e})=>{const[t,o]=B(),{elapsedCooldown:s,cooldown:i}=t.context,l=s>0;return a("div",{className:"border rounded border-white",children:[n("div",{style:{"--expand-speed":`${i}s`},className:"animate-expand"}),n(F,{className:A("icon-plus border-r border-white",{"invisible pointer-events-none":l}),onClick:()=>o({type:"SEND_UNIT",unit:r,part:e})}),n(F,{className:A("icon-minus",{"invisible pointer-events-none":l}),onClick:()=>o({type:"RECALL_UNIT",unit:r,part:e})})]})},U=({name:r,description:e})=>{const[,t]=h(),[o]=he(),{harvester:s,soldier:i}=o.context[r];return console.log(ge++),a(Q,{as:"div",distanceFactor:.5,zIndexRange:[10,0],sprite:!0,className:"text-white bg-gray-800 text-xs p-3 cursor-default select-none min-w-[12rem] rounded-md",children:[a("div",{className:"flex justify-between items-center",children:[n("h3",{className:"text-base",children:r}),n("button",{onClick:()=>t({type:"VIEW_MODULE",module:null}),className:"icon-x p-2"})]}),n("p",{className:"my-2",children:e}),a("div",{className:"flex items-center justify-between gap-1 my-1",children:[n("div",{children:"Harvesters"}),n("div",{children:s}),n(V,{unit:"harvester",part:r})]}),a("div",{className:"flex items-center justify-between gap-1 my-1",children:[n("div",{children:"Soldiers"}),n("div",{children:i}),n(V,{unit:"soldier",part:r})]})]})},ye=`
More control causes additional energy to be redistributed to the virus.
`,ve=()=>{const[r,e]=h(),t=r.context.viewedModule==="psu",{nodes:o}=p(g),[{z:s}]=y({z:t?_+.04:.04,config:b},[t]);return n(v.mesh,{name:"psu",onClick:i=>{i.stopPropagation(),e({type:"VIEW_MODULE",module:t?null:"psu"})},geometry:o.psu.geometry,material:o.psu.material,"position-x":.002,"position-y":.159,"position-z":s,children:t&&n(U,{name:"psu",description:ye})})},fe=`
More control creates a greater chance every clock tick that a random unit will be generated.
`,be=()=>{const r=.061,[e,t]=h(),o=e.context.viewedModule==="gpu",{nodes:s,materials:i}=p(g),[{z:l}]=y({z:o?_+r:r,config:b},[o]),m=x.exports.useRef(null);return D(()=>{m.current.rotation.y+=.01+1/u.state.context.interval}),a(v.group,{name:"gpu",onClick:w=>{w.stopPropagation(),t({type:"VIEW_MODULE",module:o?null:"gpu"})},"position-x":.003,"position-y":-.076,"position-z":l,children:[n("mesh",{geometry:s.Cube002.geometry,material:s.Cube002.material}),n("mesh",{geometry:s.Cube002_1.geometry,material:s.Cube002_1.material}),n("mesh",{geometry:s.Cube002_2.geometry,material:s.Cube002_2.material}),n("mesh",{name:"gpu-fan",ref:m,geometry:s.gpu_fan.geometry,material:i.light_metal,position:[.07,.015,.001]}),o&&n(U,{name:"gpu",description:fe})]})},xe=`
More control speeds up the game clock for the virus only.
`,_e=()=>{const[r,e]=h(),t=r.context.viewedModule==="cpu",{nodes:o,materials:s}=p(g),[{z:i}]=y({z:t?_+.037:.037,config:b},[t]),[{z:l}]=y({z:t?.06:.012,config:b},[t]),m=x.exports.useRef(null);return D(()=>{m.current.rotation.z+=.01+1/u.state.context.interval*.01}),a(de,{children:[n(v.mesh,{name:"cpu",geometry:o.cpu.geometry,material:o.cpu.material,"position-x":0,"position-y":0,"position-z":l}),a(v.group,{name:"cpu-cooler",onClick:w=>{w.stopPropagation(),e({type:"VIEW_MODULE",module:t?null:"cpu"})},"position-x":0,"position-y":0,"position-z":i,children:[n("mesh",{geometry:o.Cube011.geometry,material:o.Cube011.material}),n("mesh",{geometry:o.Cube011_1.geometry,material:s.sand}),n("mesh",{name:"cpu-fan",ref:m,geometry:o.cpu_fan.geometry,material:s.brown,position:[0,0,.01]}),t&&n(U,{name:"cpu",description:xe})]})]})};var Ue="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}",Ee="uniform float time;varying vec2 vUv;void main(){vec3 rgb=0.5+0.5*cos(time+vUv.xyx+vec3(0,2,4));gl_FragColor=vec4(rgb,1.0);}";const Ne=ee({time:0},Ue,Ee);X({RamMaterial:Ne});const Ce=`
More control results in faster cooldowns when assigning units.
`,Te=()=>{const[r,e]=h(),t=r.context.viewedModule==="ram",{nodes:o,materials:s}=p(g),[{z:i}]=y({z:t?_+.047:.047,config:b},[t]),l=x.exports.useRef(null);return D(()=>l.current.uniforms.time.value+=.01),a(v.group,{onClick:m=>{m.stopPropagation(),e({type:"VIEW_MODULE",module:t?null:"ram"})},"position-x":.068,"position-y":.013,"position-z":i,children:[n("mesh",{geometry:o.Cube009.geometry,material:o.Cube009.material}),n("mesh",{geometry:o.Cube009_1.geometry,material:o.Cube009_1.material}),n("mesh",{geometry:o.Cube009_2.geometry,material:s.red,children:n("ramMaterial",{ref:l,attach:"material",color:"hotpink"})}),t&&n(U,{name:"ram",description:Ce})]})},we=`
More control allows additional units to be built.
`,Ie=()=>{const[r,e]=h(),t=r.context.viewedModule==="ssd",{nodes:o}=p(g),[{z:s}]=y({z:t?_+.016:.016,config:b},[t]);return n(v.mesh,{onClick:i=>{i.stopPropagation(),e({type:"VIEW_MODULE",module:t?null:"ssd"})},geometry:o.ssd.geometry,material:o.ssd.material,"position-x":0,"position-y":.062,"position-z":s,children:t&&n(U,{name:"ssd",description:we})})};p.preload(g);const Se=e=>{var r=H(e,[]);const{nodes:t,materials:o}=p(g);return a("group",I(N({},r),{dispose:null,children:[n("mesh",{name:"motherboard",geometry:t.motherboard.geometry,material:o.green}),n("mesh",{name:"io",geometry:t.io.geometry,material:t.io.material,position:[-.092,.014,.032]}),n("mesh",{name:"motherboard_gpu_io",geometry:t.motherboard_gpu_io.geometry,material:t.motherboard_gpu_io.material,position:[-.044,-.077,.009]}),n("mesh",{name:"motherboard_cpu_io",geometry:t.motherboard_cpu_io.geometry,material:o.white,position:[0,0,.005]}),n("mesh",{name:"ram_io",geometry:t.ram_io.geometry,material:t.ram_io.material,position:[.078,.013,.008]}),n(ve,{}),n(be,{}),n(Te,{}),n(_e,{}),n(Ie,{})]}))},Le=()=>a("div",{className:"h-screen w-screen",children:[a(te,{mode:"concurrent",dpr:Math.min(1.5,window.devicePixelRatio),gl:{antialias:!0},camera:{position:new re(-.25,.25,.25)},children:[n(ne,{}),n("ambientLight",{intensity:.5}),n("pointLight",{position:[10,10,10]}),n(oe,{enablePan:!1,enableZoom:!1,enableRotate:!0}),n(Se,{}),n(pe,{})]}),n(me,{})]});se.render(n(x.exports.StrictMode,{children:n(Le,{})}),document.getElementById("root"));
