var oe=Object.defineProperty,re=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var B=(t,o,e)=>o in t?oe(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e,w=(t,o)=>{for(var e in o||(o={}))j.call(o,e)&&B(t,e,o[e]);if(I)for(var e of I(o))$.call(o,e)&&B(t,e,o[e]);return t},b=(t,o)=>re(t,se(o));var G=(t,o)=>{var e={};for(var r in t)j.call(t,r)&&o.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&I)for(var r of I(t))o.indexOf(r)<0&&$.call(t,r)&&(e[r]=t[r]);return e};import{c as P,a as h,i as z,u as D,A as ne,b as ae,d as ie,j as O,e as g,f as le,r as x,g as ce,h as de,p as ue,T as pe,k as me,l as q,G as he,H as ge,m as f,n as S,o as C,q as F,M as K,s as fe,t as ve,v as ye,B as we,w as be,C as xe,V as Se,x as Ce,y as _e,O as Ue,R as Le}from"./vendor.ec5f1235.js";const Ne=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}};Ne();const Ee=P({id:"game",initial:"idle",context:{conclusion:null,viewedModule:null},states:{idle:{on:{START:"running"}},running:{on:{PAUSE:"paused",END_GAME:"ended",VIEW_MODULE:{actions:"setViewedModule"}}},paused:{on:{UNPAUSE:"running"}},ended:{on:{START:{target:"running",actions:"start"}}}}},{actions:{setViewedModule:h((t,o)=>o.type!=="VIEW_MODULE"?{}:{viewedModule:o.module})}}),Z=z(Ee);Z.start();const v=()=>D(Z),d={minInterval:.1,interval:.5,cooldown:7,maxHarvester:10,maxSoldier:10,ssdHarvesterBonus:2,cpuHarvesterLimiter:.01,psuHarvesterLimiter:.05,unitsToControl:20},V={harvester:5,soldier:10},ke=P({id:"computer",initial:"running",context:{control:0,cpu:{control:0,harvester:0,soldier:0,defender:0},gpu:{control:0,harvester:0,soldier:0,defender:0},ram:{control:0,harvester:0,soldier:0,defender:0},ssd:{control:0,harvester:0,soldier:0,defender:0},psu:{control:0,harvester:0,soldier:0,defender:0}},states:{running:{on:{SEND_UNIT:{actions:["updateUnits","process"]},RECALL_UNIT:{actions:"process"},KILL_UNIT:{actions:"process"}}}}},{actions:{updateUnits:h((t,o)=>{const{part:e,unit:r}=o,n=o.type==="SEND_UNIT"?1:-1;return{[e]:b(w({},t[e]),{[r]:t[e][r]+n})}}),process:h((t,o)=>{const{part:e}=o;console.log(t[e].harvester,t[e].soldier);const r=(t[e].harvester+t[e].soldier)/d.unitsToControl;let n=0;return t[e].control=r,n+=t.cpu.control,n+=t.gpu.control,n+=t.ram.control,n+=t.ssd.control,n+=t.psu.control,console.log(),{control:n,[e]:b(w({},t[e]),{control:r})}})}}),_=z(ke);_.start();const H=t=>Number.parseFloat(t.toFixed(2)),Te=P({id:"player",initial:"idle",context:{elapsed:0,elapsedCooldown:{harvester:0,soldier:0},interval:0,cooldown:0,energy:0,harvester:0,soldier:0,max:{harvester:0,soldier:0}},states:{idle:{on:{START:{actions:"start",target:"running"}}},running:{invoke:{src:"tick"},on:{TICK:{actions:"process",target:"running"},CHANGE_SPEED:{actions:"changeSpeed"},SEND_UNIT:{actions:"sendUnit",cond:"canSendUnit"},RECALL_UNIT:{actions:"recallUnit",cond:"hasSentUnit"}}}}},{guards:{canSendUnit:(t,o)=>o.type==="SEND_UNIT"&&t.energy>=V[o.unit]&&t[o.unit]<t.max[o.unit],hasSentUnit:(t,o)=>o.type==="RECALL_UNIT"&&_.state.context[o.part][o.unit]>=1},services:{tick:(t,o)=>e=>{const{interval:r}=t,n=setTimeout(e,1e3*r,"TICK");return()=>clearTimeout(n)}},actions:{start:h((t,o)=>o.type!=="START"?{}:{elapsed:0,elapsedCooldown:{harvester:0,soldier:0},interval:d.interval,cooldown:d.cooldown,energy:o.energy,harvester:0,soldier:0,max:{harvester:d.maxHarvester,soldier:d.maxSoldier}}),process:h((t,o)=>{const{cpu:e,gpu:r,ram:n,ssd:a,psu:c}=_.state.context,p=-(e.harvester*d.cpuHarvesterLimiter),u=-(1+n.harvester/2),m=c.harvester*d.psuHarvesterLimiter,A=a.harvester*d.ssdHarvesterBonus,te=r.harvester===0?0:Math.random()*Math.max(5,200-r.harvester*2)<1?10:0;return{elapsed:t.elapsed+1,interval:Math.max(d.minInterval,d.interval+p),cooldown:d.cooldown,energy:H(t.energy+m+te),max:{harvester:d.maxHarvester+A,soldier:d.maxHarvester+A},elapsedCooldown:{harvester:Math.max(0,t.elapsedCooldown.harvester+u),soldier:Math.max(0,t.elapsedCooldown.soldier+u)}}}),changeSpeed:h((t,o)=>o.type!=="CHANGE_SPEED"?{}:{interval:t.interval+o.amount}),sendUnit:h((t,o)=>{if(o.type!=="SEND_UNIT")return{};const{unit:e,part:r}=o;return _.send({type:"SEND_UNIT",unit:e,part:r}),{[e]:t[e]+1,energy:H(t.energy-V[e]),elapsedCooldown:b(w({},t.elapsedCooldown),{[e]:d.cooldown})}}),recallUnit:h((t,o)=>{if(o.type!=="RECALL_UNIT")return{};const{unit:e,part:r}=o;return _.send({type:"RECALL_UNIT",unit:e,part:r}),{[e]:t[e]-1,energy:H(t.energy+V[e]),elapsedCooldown:b(w({},t.elapsedCooldown),{[e]:d.cooldown})}})}}),L=z(Te);L.start();const N=new ne,Me=new ae,E=new Map,R=N.context.createBiquadFilter();R.type="lowpass";const Ae=async(t,o)=>{const e=await Me.loadAsync(o),r=new ie(N);r.setBuffer(e),r.setLoop(!1),r.setVolume(.5),E.set(t,r)},J=(t,o=0)=>{if(o>0)return setTimeout(J,o,t);const e=E.get(t);e.isPlaying&&e.stop(),e.play()},Ie=t=>{const o=E.get(t);o.setLoop(!0),o.play()},Re=(t,o)=>{E.get(t).setVolume(o)},Pe=(t,o)=>{const e=E.get(t);o===!1?R.frequency.setTargetAtTime(15e3,N.context.currentTime,0):(R.frequency.setTargetAtTime(500,N.context.currentTime,0),e.setFilter(R))},i={create:Ae,play:J,loop:Ie,volume:Re,toggleLowPassFilter:Pe},Q=()=>D(L),s=O.exports.jsx,l=O.exports.jsxs,k=O.exports.Fragment,ze=()=>{var r;const[t]=Q(),{context:o}=t;let e=o.energy.toString();return e.split(".").length===1?e=`${e}.00`:((r=e.split(".").pop())==null?void 0:r.length)===1&&(e=`${e}0`),l("div",{className:"p-2",children:[s("h4",{children:"resources"}),l("p",{children:["energy: ",e]}),l("p",{children:["harvesters: ",o.harvester," / ",o.max.harvester]}),l("p",{children:["soldiers: ",o.soldier," / ",o.max.soldier]})]})},X=()=>D(_),W=({label:t,onClick:o,className:e,disabled:r=!1})=>s("button",{onClick:o,type:"button",className:g("px-2 py-1 border rounded disabled:opacity-50 disabled:cursor-auto",e),disabled:r,children:t}),De=()=>{const[t,o]=v();return l(k,{children:[!1,l("div",{className:g("absolute inset-0 pointer-events-none h-full w-full z-10 flex flex-col justify-between items-end","select-none text-white"),children:[s(ze,{}),s("div",{className:"p-2 pointer-events-auto",children:s(W,{onClick:()=>{i.play("click"),i.toggleLowPassFilter("track1",!0),o({type:"PAUSE"})},label:"pause"})}),t.matches("idle")&&s("div",{className:g("absolute z-50 w-full h-full bg-black bg-opacity-30 backdrop-filter backdrop-blur-sm","grid place-content-center pointer-events-auto text-white"),children:s(W,{onClick:()=>{i.volume("track1",.3),i.loop("track1"),i.play("click"),o({type:"START"}),L.send({type:"START",energy:20})},label:"start"})}),t.matches("ended")&&s("div",{className:g("absolute z-50 w-full h-full bg-black bg-opacity-30","grid place-content-center pointer-events-auto text-white"),children:s("h2",{children:"It's over."})}),t.matches("paused")&&l("div",{className:g("absolute z-50 w-full h-full bg-black bg-opacity-30 backdrop-filter backdrop-blur-sm","grid place-content-center pointer-events-auto text-white"),children:[s("h2",{className:"uppercase text-8xl",children:"Paused"}),s(W,{onClick:()=>{i.play("click"),i.toggleLowPassFilter("track1",!1),o({type:"UNPAUSE"})},label:"resume"})]})]})]})},Oe=()=>{const{camera:t}=le(),[o]=X(),{control:e}=o.context;return x.exports.useEffect(()=>{t.add(N)},[t]),l(ce,{multisampling:8,children:[s(de,{intensity:.7,height:200,luminanceThreshold:.4,luminanceSmoothing:.9}),s(ue,{opacity:.06}),s(pe,{eskil:!1,offset:0,darkness:1.3}),s(me,{delay:[q(4,.1,(e-.5)*2),q(5,.2,(e-.5)*2)],duration:[.6,1],strength:[.05,.5],mode:he.SPORADIC,active:e>.5,ratio:.85})]})},T=.1,U={mass:1,tension:1e3,friction:25,precision:1e-4},y=new URL("/game-off-2021/assets/computer.185dcdf2.glb",self.location).href,Y=({onClick:t,label:o,className:e})=>s("button",{type:"button",className:`px-2 py-1 ${e}`,onClick:t,children:o}),ee=({unit:t,part:o})=>{const[e,r]=Q(),{elapsedCooldown:n,cooldown:a}=e.context,c=n[t]>0;return l("div",{className:"relative overflow-hidden border rounded border-white bg-opacity-50",children:[c&&s("div",{style:{transform:`scale(${1-n[t]/a}, 1)`},className:"absolute w-full h-full bg-white origin-left transition-transform duration-500"}),s(Y,{className:g("icon-plus border-r border-white",{"invisible pointer-events-none":c}),onClick:()=>{i.play("click"),r({type:"SEND_UNIT",unit:t,part:o})}}),s(Y,{className:g("icon-minus",{"invisible pointer-events-none":c}),onClick:()=>{i.play("click"),r({type:"RECALL_UNIT",unit:t,part:o})}})]})},M=({name:t,description:o})=>{const[,e]=v(),[r]=X(),{harvester:n,soldier:a}=r.context[t];return l(ge,{as:"div",distanceFactor:.5,zIndexRange:[10,0],sprite:!0,className:"text-white bg-gray-800 text-xs p-3 cursor-default select-none min-w-[12rem] rounded-md",children:[l("div",{className:"flex justify-between items-center",children:[s("h3",{className:"text-base",children:t}),s("button",{onClick:()=>{i.play("click"),e({type:"VIEW_MODULE",module:null})},className:"icon-x p-2"})]}),s("p",{className:"my-2",children:o}),l("div",{className:"flex items-center justify-between gap-1 my-1",children:[s("div",{children:"Harvesters"}),s("div",{children:n}),s(ee,{unit:"harvester",part:t})]}),l("div",{className:"flex items-center justify-between gap-1 my-1",children:[s("div",{children:"Soldiers"}),s("div",{children:a}),s(ee,{unit:"soldier",part:t})]})]})},Fe=`
Causes energy to be generated for the virus.
`,Ve=()=>{const[t,o]=v(),e=t.context.viewedModule==="psu",{nodes:r}=f(y),[{z:n}]=S({z:e?T+.04:.04,config:U},[e]);return s(C.mesh,{name:"psu",castShadow:!0,onClick:a=>{a.stopPropagation(),t.context.viewedModule!==null&&i.play("attach",50),i.play(e?"attach":"remove",e?50:0),o({type:"VIEW_MODULE",module:e?null:"psu"})},geometry:r.psu.geometry,material:r.psu.material,"position-x":.002,"position-y":.159,"position-z":n,children:e&&s(M,{name:"psu",description:Fe})})},He=`
Creates a greater chance every clock tick that a random unit will be generated.
`,We=()=>{const t=.061,[o,e]=v(),r=o.context.viewedModule==="gpu",{nodes:n,materials:a}=f(y),[{z:c}]=S({z:r?T+t:t,config:U},[r]),p=x.exports.useRef(null);return F(()=>{o.matches("running")&&(p.current.rotation.y+=.01+1/L.state.context.interval)}),l(C.group,{name:"gpu",onClick:u=>{u.stopPropagation(),o.context.viewedModule!==null&&i.play("attach",50),i.play(r?"attach":"remove",r?50:0),e({type:"VIEW_MODULE",module:r?null:"gpu"})},"position-x":.003,"position-y":-.076,"position-z":c,children:[s(K,{castShadow:!0,receiveShadow:!0,meshes:[n.Cube002,n.Cube002_1,n.Cube002_2],children:(u,m,A)=>l(k,{children:[s(u,{material:n.Cube002.material}),s(m,{material:n.Cube002_1.material}),s(A,{material:n.Cube002_2.material})]})}),s("mesh",{castShadow:!0,receiveShadow:!0,name:"gpu-fan",ref:p,geometry:n.gpu_fan.geometry,material:a.light_metal,position:[.0675,.015,.001]}),r&&s(M,{name:"gpu",description:He})]})},je=`
Speeds up the game clock for the virus.
`,$e=()=>{const[t,o]=v(),{viewedModule:e}=t.context,r=e==="cpu",{nodes:n,materials:a}=f(y),[{z:c}]=S({z:r?T+.037:.037,config:U},[r]),[{z:p}]=S({z:r?.06:.012,config:U},[r]),u=x.exports.useRef(null);return F(()=>{t.matches("running")&&(u.current.rotation.z+=.01+1/L.state.context.interval*.01)}),l(k,{children:[s(C.mesh,{name:"cpu",castShadow:!0,receiveShadow:!0,onClick:m=>{m.stopPropagation(),e!==null&&i.play("attach",50),i.play(r?"attach":"remove",r?50:0),o({type:"VIEW_MODULE",module:r?null:"cpu"})},geometry:n.cpu.geometry,material:n.cpu.material,"position-x":0,"position-y":0,"position-z":p}),l(C.group,{name:"cpu-cooler",onClick:m=>{m.stopPropagation(),e!==null&&i.play("attach",50),i.play(r?"attach":"remove",r?50:0),o({type:"VIEW_MODULE",module:r?null:"cpu"})},"position-x":0,"position-y":0,"position-z":c,children:[s("mesh",{castShadow:!0,receiveShadow:!0,geometry:n.Cube011.geometry,material:n.Cube011.material}),s("mesh",{castShadow:!0,receiveShadow:!0,geometry:n.Cube011_1.geometry,material:a.sand}),s("mesh",{name:"cpu-fan",castShadow:!0,receiveShadow:!0,ref:u,geometry:n.cpu_fan.geometry,material:a.brown,position:[0,0,.01]}),r&&s(M,{name:"cpu",description:je})]})]})};var Be="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}",Ge="uniform float time;varying vec2 vUv;void main(){vec3 rgb=0.5+0.5*cos(time+vUv.xyx+vec3(0,2,4));gl_FragColor=vec4(rgb,1.0);}";const qe=ve({time:0},Be,Ge);fe({RamMaterial:qe});const Ke=`
Results in faster cooldowns when assigning units.
`,Ze=()=>{const[t,o]=v(),e=t.context.viewedModule==="ram",{nodes:r,materials:n}=f(y),[{z:a}]=S({z:e?T+.047:.047,config:U},[e]),c=x.exports.useRef(null);return F(()=>{c.current.uniforms.time.value+=.01}),l(C.group,{onClick:p=>{p.stopPropagation(),t.context.viewedModule!==null&&i.play("attach",50),i.play(e?"attach":"remove",e?50:0),o({type:"VIEW_MODULE",module:e?null:"ram"})},"position-x":.068,"position-y":.013,"position-z":a,children:[s("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.Cube009.geometry,material:r.Cube009.material}),s("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.Cube009_1.geometry,material:r.Cube009_1.material}),s("mesh",{castShadow:!0,geometry:r.Cube009_2.geometry,material:n.red,children:s("ramMaterial",{ref:c,attach:"material",color:"hotpink"})}),e&&s(M,{name:"ram",description:Ke})]})},Je=`
allows additional units to be built.
`,Qe=()=>{const[t,o]=v(),e=t.context.viewedModule==="ssd",{nodes:r}=f(y),[{z:n}]=S({z:e?T+.016:.016,config:U},[e]);return s(C.mesh,{name:"ssd",castShadow:!0,receiveShadow:!0,onClick:a=>{a.stopPropagation(),t.context.viewedModule!==null&&i.play("attach",50),i.play(e?"attach":"remove",e?50:0),o({type:"VIEW_MODULE",module:e?null:"ssd"})},geometry:r.ssd.geometry,material:r.ssd.material,"position-x":0,"position-y":.062,"position-z":n,children:e&&s(M,{name:"ssd",description:Je})})};f.preload(y);const Xe=o=>{var t=G(o,[]);const{nodes:e,materials:r}=f(y),n=[e.motherboard,e.io,e.motherboard_gpu_io,e.motherboard_cpu_io,e.ram_io];return l("group",b(w({},t),{dispose:null,children:[s(K,{castShadow:!0,receiveShadow:!0,meshes:n,children:(a,c,p,u,m)=>l(k,{children:[s(a,{name:"motherboard",material:r.green}),s(c,{name:"io",material:e.io.material,position:[-.092,.014,.032]}),s(p,{name:"motherboard_gpu_io",material:e.motherboard_gpu_io.material,position:[-.044,-.077,.009]}),s(u,{name:"motherboard_cpu_io",material:r.white,position:[0,0,.005]}),s(m,{name:"ram_io",material:e.ram_io.material,position:[.078,.013,.008]})]})}),s(Ve,{}),s(We,{}),s(Ze,{}),s($e,{}),s(Qe,{})]}))};ye({frustum:1.75,size:.005,near:2.5,samples:30,rings:11});const Ye=({bake:t})=>{const o=1;return l(k,{children:[t&&s(we,{}),s("ambientLight",{intensity:.1}),s("directionalLight",{castShadow:!0,position:[1,1,1],intensity:2,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048,"shadow-camera-far":25,"shadow-camera-left":-o,"shadow-camera-right":o,"shadow-camera-top":o,"shadow-camera-bottom":-o,onUpdate:e=>e.lookAt(0,0,0)}),s("spotLight",{intensity:.5,position:[-5,10,2],angle:.2,penumbra:1,"shadow-mapSize":[2048,2048],onUpdate:e=>e.lookAt(0,0,0)}),s("rectAreaLight",{color:"red",intensity:.3,position:[1.5,-1,3],width:10,height:10,onUpdate:e=>e.lookAt(0,0,0)})]})};i.create("click",new URL("/game-off-2021/assets/click.359c8c98.wav",self.location).href);i.create("attach",new URL("/game-off-2021/assets/attach.3ec71000.wav",self.location).href);i.create("remove",new URL("/game-off-2021/assets/remove.34b2a270.wav",self.location).href);i.create("track1",new URL("/game-off-2021/assets/track_1.012e24df.mp3",self.location).href);const et=()=>{const{tier:t,gpu:o=""}=be(),e=t<2&&/apple (gpu|m1)/i.test(o)===!1;return l("div",{className:"h-screen w-screen",children:[l(xe,{shadows:!0,mode:"concurrent",performance:{min:.75},dpr:Math.min(e?.9:1.5,window.devicePixelRatio),gl:{alpha:!1,antialias:!1},camera:{position:new Se(.25,.15,.25)},children:[s(Ce,{pixelated:!0}),s(_e,{}),s(Oe,{}),s(Ue,{enablePan:!1,enableZoom:!1,enableRotate:!0}),s(Ye,{bake:e}),s(Xe,{})]}),s(De,{})]})};Le.render(s(x.exports.StrictMode,{children:s(x.exports.Suspense,{fallback:null,children:s(et,{})})}),document.getElementById("root"));
