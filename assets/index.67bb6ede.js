var O=Object.defineProperty,S=Object.defineProperties;var w=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var I=(n,e,t)=>e in n?O(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,N=(n,e)=>{for(var t in e||(e={}))T.call(e,t)&&I(n,t,e[t]);if(m)for(var t of m(e))x.call(e,t)&&I(n,t,e[t]);return n},C=(n,e)=>S(n,w(e));var _=(n,e)=>{var t={};for(var r in n)T.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&m)for(var r of m(n))e.indexOf(r)<0&&x.call(n,r)&&(t[r]=n[r]);return t};import{c as k,a as l,i as D,j as A,b as z,u as M,r as v,H as V,d as c,e as g,f as h,C as B,V as P,O as j,g as W,h as J,p as F,T as G,R as H,k as K}from"./vendor.df1185dd.js";const $=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const b of i.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&r(b)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}};$();const R={harvester:{cost:5},soldier:{cost:10}},Z=k({id:"game",initial:"idle",context:{energy:0,harvester:0,soldier:0,viewedModule:null,allocations:{harvester:{cpu:0,gpu:0,ram:0,ssd:0,psu:0},soldier:{cpu:0,gpu:0,ram:0,ssd:0,psu:0}}},states:{idle:{on:{START:{target:"running",actions:"setResources"},RESUME:{target:"running",actions:"setContext"}}},running:{on:{PAUSE:"paused",END_GAME:"ended",VIEW_MODULE:{target:"running",actions:"setViewedModule"},BUILD_UNIT:{target:"running",actions:"buildUnit",cond:"hasEnergyForUnit"},ALLOCATE_UNIT:{target:"running",actions:"allocateUnit",cond:"hasUnit"},RECALL_UNIT:{target:"running",actions:"recallUnit",cond:"hasAllocatedUnits"},KILL_UNIT:{target:"running",actions:"killUnit",cond:"hasAllocatedUnits"}}},paused:{on:{START:"running"}},ended:{on:{RESET:{target:"idle",actions:"resetContext"}}}}},{guards:{hasUnit:(n,e)=>e.type==="ALLOCATE_UNIT"&&n[e.unit]>0,hasEnergyForUnit:(n,e)=>e.type==="BUILD_UNIT"&&n.energy>=R[e.unit].cost,hasAllocatedUnits:(n,e)=>(e.type==="KILL_UNIT"||e.type==="RECALL_UNIT")&&n.allocations[e.unit][e.part]>=1},actions:{setResources:l((n,e)=>e.type!=="START"?{}:e.resources),buildUnit:l((n,e)=>{if(e.type!=="BUILD_UNIT")return{};const{unit:t}=e;return{energy:n.energy-R[t].cost,[t]:n[t]+1}}),allocateUnit:l((n,e)=>{if(e.type!=="ALLOCATE_UNIT")return{};const{unit:t,part:r}=e,o=JSON.parse(JSON.stringify(n.allocations));return o[t][r]+=1,{[t]:n[t]-1,allocations:o}}),recallUnit:l((n,e)=>{if(e.type!=="RECALL_UNIT")return{};const{unit:t,part:r}=e,o=JSON.parse(JSON.stringify(n.allocations));return o[t][r]-=1,{[t]:n[t]+1,allocations:o}}),killUnit:l((n,e)=>{if(e.type!=="KILL_UNIT")return{};const t=JSON.parse(JSON.stringify(n.allocations));return t[e.unit][e.part]-=1,{allocations:t}}),setViewedModule:l((n,e)=>e.type!=="VIEW_MODULE"?{}:{viewedModule:e.module}),resetContext:l((n,e)=>e.type!=="END_GAME"?{}:{energy:0,harvester:0,soldier:0,viewedModule:null,allocations:{harvester:{cpu:0,gpu:0,ram:0,ssd:0,psu:0},soldier:{cpu:0,gpu:0,ram:0,ssd:0,psu:0}}}),setContext:l((n,e)=>e.type!=="RESUME"?{}:e.context)}}),E=D(Z),s=A.exports.jsx,a=A.exports.jsxs,y=({label:n,onClick:e,className:t,disabled:r=!1})=>s("button",{onClick:e,type:"button",className:z("px-2 py-1 border rounded disabled:opacity-50 disabled:cursor-auto",t),disabled:r,children:n}),q=()=>{const[n,e]=M(E);v.exports.useEffect(()=>{e({type:"START",resources:{energy:100,harvester:5,soldier:5}})},[]);const{energy:t,harvester:r,soldier:o}=n.context;return a("div",{className:"absolute inset-0 pointer-events-none h-full w-full z-10 flex flex-col justify-between items-end select-none",children:[n.matches("ended")&&s("p",{children:"Ended"}),a("div",{className:"p-2",children:[s("h4",{children:"Resources"}),a("p",{children:["Energy: ",t]}),a("p",{children:["Harvesters: ",r]}),a("p",{children:["Soldiers: ",o]})]}),a("div",{className:"p-2 pointer-events-auto",children:[s(y,{onClick:()=>e("PAUSE"),label:"pause"}),s(y,{disabled:t===0,onClick:()=>e({type:"BUILD_UNIT",unit:"harvester"}),label:"Build harvester (-5)"}),s(y,{disabled:t===0,onClick:()=>e({type:"BUILD_UNIT",unit:"soldier"}),label:"Build soldier (-10)"})]}),n.matches("paused")&&a("div",{className:"absolute w-full h-full bg-black bg-opacity-20 backdrop-filter backdrop-blur-sm grid place-content-center pointer-events-auto text-white",children:[s("h2",{className:"uppercase text-8xl",children:"Paused"}),s(y,{onClick:()=>e("START"),label:"resume"})]})]})},f=.1,U={mass:1,tension:1e3,friction:25,precision:1e-4},d=new URL("/game-off-2021/assets/computer.5b102dfe.glb",self.location).href,u=()=>(v.exports.useEffect(()=>{E.start()},[]),M(E)),p=({onClick:n,label:e,className:t})=>s("button",{type:"button",className:`border border-white px-2 py-1 ${t}`,onClick:n,children:e}),L=({name:n})=>{const[e,t]=u(),{harvester:r,soldier:o}=e.context.allocations;return a(V,{as:"div",distanceFactor:.25,zIndexRange:[100,0],transform:!0,sprite:!0,className:"text-white bg-gray-800 text-xs p-2 select-none",children:[s("p",{children:n}),a("p",{children:["Harvesters: ",r[n],s(p,{label:"+",onClick:()=>t({type:"ALLOCATE_UNIT",unit:"harvester",part:n})}),s(p,{label:"-",onClick:()=>t({type:"RECALL_UNIT",unit:"harvester",part:n})})]}),a("p",{children:["Soldiers: ",o[n],s(p,{label:"+",onClick:()=>t({type:"ALLOCATE_UNIT",unit:"soldier",part:n})}),s(p,{label:"-",onClick:()=>t({type:"RECALL_UNIT",unit:"soldier",part:n})})]}),s(p,{label:"Done",onClick:()=>t({type:"VIEW_MODULE",module:null})})]})},Q=()=>{const[n,e]=u(),t=n.context.viewedModule==="gpu",{nodes:r}=c(d),[{z:o}]=g({z:t?f+.06:.06,config:U},[t]);return s(h.mesh,{onClick:()=>e({type:"VIEW_MODULE",module:t?null:"gpu"}),geometry:r.gpu.geometry,material:r.gpu.material,"position-x":0,"position-y":-.08,"position-z":o,children:t&&s(L,{name:"gpu"})})},X=()=>{const[n,e]=u(),t=n.context.viewedModule==="cpu",{nodes:r,materials:o}=c(d),[{z:i}]=g({z:t?f+.02:.02,config:U},[t]);return s(h.mesh,{onClick:()=>e({type:"VIEW_MODULE",module:t?null:"cpu"}),geometry:r.cpu.geometry,material:o.sand,"position-x":0,"position-y":0,"position-z":i,children:t&&s(L,{name:"cpu"})})},Y=()=>{const[n,e]=u(),t=n.context.viewedModule==="ram",{nodes:r,materials:o}=c(d),[{z:i}]=g({z:t?f+.04:.04,config:U},[t]);return s(h.mesh,{onClick:()=>e({type:"VIEW_MODULE",module:t?null:"ram"}),geometry:r.ram.geometry,material:o.red,"position-x":.07,"position-y":.01,"position-z":i,children:t&&s(L,{name:"ram"})})},ee=()=>{const[n,e]=u(),t=n.context.viewedModule==="ssd",{nodes:r}=c(d),[{z:o}]=g({z:t?f+.02:.02,config:U},[t]);return s(h.mesh,{onClick:()=>e({type:"VIEW_MODULE",module:t?null:"ssd"}),geometry:r.ssd.geometry,material:r.ssd.material,"position-x":0,"position-y":.06,"position-z":o,children:t&&s(L,{name:"ssd"})})};c.preload(d);const te=e=>{var n=_(e,[]);const{nodes:t,materials:r}=c(d);return a("group",C(N({},n),{dispose:null,children:[s("mesh",{geometry:t.motherboard.geometry,material:r.green}),s(Q,{}),s("mesh",{geometry:t.io.geometry,material:t.io.material,position:[-.09,.01,.03]}),s("mesh",{geometry:t["motherboard-gpu-io"].geometry,material:t["motherboard-gpu-io"].material,position:[-.04,-.08,-.01]}),s("mesh",{geometry:t["motherboard-cpu-io"].geometry,material:r.white}),s(Y,{}),s(X,{}),s(ee,{})]}))},ne=()=>a("div",{className:"h-screen w-screen",children:[a(B,{mode:"concurrent",dpr:Math.min(1.5,window.devicePixelRatio),gl:{antialias:!1},camera:{position:new P(0,0,.5)},children:[s("ambientLight",{}),s("pointLight",{position:[10,10,10]}),s(j,{enablePan:!1,enableZoom:!1,enableRotate:!0}),s(te,{}),a(W,{children:[s(J,{luminanceThreshold:0,luminanceSmoothing:.9,height:300}),s(F,{opacity:.1}),s(G,{eskil:!1,offset:.1,darkness:1.1})]})]}),s(q,{})]});H.render(s(K.StrictMode,{children:s(ne,{})}),document.getElementById("root"));
