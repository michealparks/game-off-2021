var X=Object.defineProperty,Y=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var W=(e,o,t)=>o in e?X(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,_=(e,o)=>{for(var t in o||(o={}))V.call(o,t)&&W(e,t,o[t]);if(k)for(var t of k(o))j.call(o,t)&&W(e,t,o[t]);return e},U=(e,o)=>Y(e,ee(o));var $=(e,o)=>{var t={};for(var r in e)V.call(e,r)&&o.indexOf(r)<0&&(t[r]=e[r]);if(e!=null&&k)for(var r of k(e))o.indexOf(r)<0&&j.call(e,r)&&(t[r]=e[r]);return t};import{c as I,a as h,i as R,u as z,A as te,b as oe,d as se,j as P,e as C,r as m,f as re,g as ne,h as ae,p as ie,T as ce,H as le,k as g,l as y,m as w,n as D,M as B,o as de,q as ue,s as pe,t as me,v as he,B as ge,C as ve,V as fe,w as ye,x as we,O as be,R as xe}from"./vendor.0eaa58e6.js";const Se=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}};Se();const _e=I({id:"computer",initial:"running",context:{cpu:{harvester:0,soldier:0,defender:0},gpu:{harvester:0,soldier:0,defender:0},ram:{harvester:0,soldier:0,defender:0},ssd:{harvester:0,soldier:0,defender:0},psu:{harvester:0,soldier:0,defender:0}},states:{running:{on:{SEND_UNIT:{actions:"updateUnit"},RECALL_UNIT:{actions:"updateUnit"},KILL_UNIT:{actions:"updateUnit"}}}}},{actions:{updateUnit:h((e,o)=>{const{part:t,unit:r}=o,n=o.type==="SEND_UNIT"?1:-1;return{[t]:U(_({},e[t]),{[r]:e[t][r]+n})}})}}),b=R(_e);b.start();const l={minInterval:.1,interval:.5,cooldown:7,maxHarvester:10,maxSoldier:10,ssdHarvesterBonus:2,cpuHarvesterLimiter:.01,psuHarvesterLimiter:.05},O={harvester:5,soldier:10},H=e=>Number.parseFloat(e.toFixed(2)),Ue=I({id:"player",initial:"idle",context:{elapsed:0,elapsedCooldown:{harvester:0,soldier:0},interval:0,cooldown:0,energy:0,harvester:0,soldier:0,max:{harvester:0,soldier:0}},states:{idle:{on:{START:{actions:"start",target:"running"}}},running:{invoke:{src:"tick"},on:{TICK:{actions:"process",target:"running"},CHANGE_SPEED:{actions:"changeSpeed"},SEND_UNIT:{actions:"sendUnit",cond:"canSendUnit"},RECALL_UNIT:{actions:"recallUnit",cond:"hasSentUnit"}}}}},{guards:{canSendUnit:(e,o)=>o.type==="SEND_UNIT"&&e.energy>=O[o.unit]&&e[o.unit]<e.max[o.unit],hasSentUnit:(e,o)=>o.type==="RECALL_UNIT"&&b.state.context[o.part][o.unit]>=1},services:{tick:(e,o)=>t=>{const{interval:r}=e,n=setTimeout(t,1e3*r,"TICK");return()=>clearTimeout(n)}},actions:{start:h((e,o)=>o.type!=="START"?{}:{elapsed:0,elapsedCooldown:{harvester:0,soldier:0},interval:l.interval,cooldown:l.cooldown,energy:o.energy,harvester:0,soldier:0,max:{harvester:l.maxHarvester,soldier:l.maxSoldier}}),process:h((e,o)=>{const{cpu:t,gpu:r,ram:n,ssd:a,psu:c}=b.state.context,u=-(t.harvester*l.cpuHarvesterLimiter),p=-(1+n.harvester/2),S=c.harvester*l.psuHarvesterLimiter,M=a.harvester*l.ssdHarvesterBonus,Q=r.harvester===0?0:Math.random()*Math.max(5,200-r.harvester*2)<1?10:0;return{elapsed:e.elapsed+1,interval:Math.max(l.minInterval,l.interval+u),cooldown:l.cooldown,energy:H(e.energy+S+Q),max:{harvester:l.maxHarvester+M,soldier:l.maxHarvester+M},elapsedCooldown:{harvester:Math.max(0,e.elapsedCooldown.harvester+p),soldier:Math.max(0,e.elapsedCooldown.soldier+p)}}}),changeSpeed:h((e,o)=>o.type!=="CHANGE_SPEED"?{}:{interval:e.interval+o.amount}),sendUnit:h((e,o)=>{if(o.type!=="SEND_UNIT")return{};const{unit:t,part:r}=o;return b.send({type:"SEND_UNIT",unit:t,part:r}),{[t]:e[t]+1,energy:H(e.energy-O[t]),elapsedCooldown:U(_({},e.elapsedCooldown),{[t]:l.cooldown})}}),recallUnit:h((e,o)=>{if(o.type!=="RECALL_UNIT")return{};const{unit:t,part:r}=o;return b.send({type:"RECALL_UNIT",unit:t,part:r}),{[t]:e[t]-1,energy:H(e.energy+O[t]),elapsedCooldown:U(_({},e.elapsedCooldown),{[t]:l.cooldown})}})}}),E=R(Ue);E.start();const Ce=I({id:"game",initial:"idle",context:{conclusion:null,viewedModule:null},states:{idle:{on:{START:{target:"running",actions:"start"}}},running:{on:{PAUSE:"paused",END_GAME:"ended",VIEW_MODULE:{actions:"setViewedModule"}}},paused:{on:{UNPAUSE:"running"}},ended:{on:{START:{target:"running",actions:"start"}}}}},{actions:{start:h((e,o)=>o.type!=="START"?{}:(E.send(o),{})),setViewedModule:h((e,o)=>o.type!=="VIEW_MODULE"?{}:{viewedModule:o.module})}}),F=R(Ce);F.start();const v=()=>z(F),G=new te,Ee=new oe,T=new Map,Ne=async(e,o)=>{const t=await Ee.loadAsync(o),r=new se(G);r.setBuffer(t),r.setLoop(!1),r.setVolume(.5),T.set(e,r)},Le=e=>{T.get(e).play()},Me=e=>{const o=T.get(e);o.setLoop(!0),o.play()},ke=(e,o)=>{T.get(e).setVolume(o)},d={create:Ne,play:Le,loop:Me,volume:ke},K=()=>z(E),s=P.exports.jsx,i=P.exports.jsxs,A=P.exports.Fragment,Te=()=>{var r;const[e]=K(),{context:o}=e;let t=o.energy.toString();return t.split(".").length===1?t=`${t}.00`:((r=t.split(".").pop())==null?void 0:r.length)===1&&(t=`${t}0`),i("div",{className:"p-2",children:[i("p",{children:["elapsed: ",o.elapsed]}),i("p",{children:["interval: ",o.interval]}),s("h4",{children:"resources"}),i("p",{children:["energy: ",t]}),i("p",{children:["harvesters: ",o.harvester," / ",o.max.harvester]}),i("p",{children:["soldiers: ",o.soldier," / ",o.max.soldier]})]})},Z=({label:e,onClick:o,className:t,disabled:r=!1})=>s("button",{onClick:o,type:"button",className:C("px-2 py-1 border rounded disabled:opacity-50 disabled:cursor-auto",t),disabled:r,children:e}),Ae=()=>{const[e,o]=v();return m.exports.useEffect(()=>{o({type:"START",energy:10})},[]),i("div",{className:C("absolute inset-0 pointer-events-none h-full w-full z-10 flex flex-col justify-between items-end","select-none text-white"),children:[s(Te,{}),s("div",{className:"p-2 pointer-events-auto",children:s(Z,{onClick:()=>{d.play("click"),o({type:"PAUSE"})},label:"pause"})}),e.matches("ended")&&s("p",{children:"Ended"}),e.matches("paused")&&i("div",{className:C("absolute z-50 w-full h-full bg-black bg-opacity-30 backdrop-filter backdrop-blur-sm","grid place-content-center pointer-events-auto text-white"),children:[s("h2",{className:"uppercase text-8xl",children:"Paused"}),s(Z,{onClick:()=>{d.play("click"),console.log("unpause"),o({type:"UNPAUSE"})},label:"resume"})]})]})},Ie=()=>{const{camera:e}=re();return m.exports.useEffect(()=>{e.add(G)},[e]),i(ne,{multisampling:8,children:[s(ae,{intensity:.7,height:200,luminanceThreshold:.4,luminanceSmoothing:.9}),s(ie,{opacity:.06}),s(ce,{eskil:!1,offset:0,darkness:1.3})]})},N=.1,x={mass:1,tension:1e3,friction:25,precision:1e-4},f=new URL("/game-off-2021/assets/computer.185dcdf2.glb",self.location).href,Re=()=>z(b),q=({onClick:e,label:o,className:t})=>s("button",{type:"button",className:`px-2 py-1 ${t}`,onClick:e,children:o}),J=({unit:e,part:o})=>{const[t,r]=K(),{elapsedCooldown:n,cooldown:a}=t.context,c=n[e]>0;return i("div",{className:"relative overflow-hidden border rounded border-white bg-opacity-50",children:[c&&s("div",{style:{transform:`scale(${1-n[e]/a}, 1)`},className:"absolute w-full h-full bg-white origin-left transition-transform duration-500"}),s(q,{className:C("icon-plus border-r border-white",{"invisible pointer-events-none":c}),onClick:()=>r({type:"SEND_UNIT",unit:e,part:o})}),s(q,{className:C("icon-minus",{"invisible pointer-events-none":c}),onClick:()=>r({type:"RECALL_UNIT",unit:e,part:o})})]})},L=({name:e,description:o})=>{const[,t]=v(),[r]=Re(),{harvester:n,soldier:a}=r.context[e];return i(le,{as:"div",distanceFactor:.5,zIndexRange:[10,0],sprite:!0,className:"text-white bg-gray-800 text-xs p-3 cursor-default select-none min-w-[12rem] rounded-md",children:[i("div",{className:"flex justify-between items-center",children:[s("h3",{className:"text-base",children:e}),s("button",{onClick:()=>t({type:"VIEW_MODULE",module:null}),className:"icon-x p-2"})]}),s("p",{className:"my-2",children:o}),i("div",{className:"flex items-center justify-between gap-1 my-1",children:[s("div",{children:"Harvesters"}),s("div",{children:n}),s(J,{unit:"harvester",part:e})]}),i("div",{className:"flex items-center justify-between gap-1 my-1",children:[s("div",{children:"Soldiers"}),s("div",{children:a}),s(J,{unit:"soldier",part:e})]})]})},ze=`
Causes additional energy to be redistributed to the virus.
`,Pe=()=>{const[e,o]=v(),t=e.context.viewedModule==="psu",{nodes:r}=g(f),[{z:n}]=y({z:t?N+.04:.04,config:x},[t]);return s(w.mesh,{name:"psu",castShadow:!0,onClick:a=>{a.stopPropagation(),d.play(t?"attach":"remove"),o({type:"VIEW_MODULE",module:t?null:"psu"})},geometry:r.psu.geometry,material:r.psu.material,"position-x":.002,"position-y":.159,"position-z":n,children:t&&s(L,{name:"psu",description:ze})})},De=`
Creates a greater chance every clock tick that a random unit will be generated.
`,Oe=()=>{const e=.061,[o,t]=v(),r=o.context.viewedModule==="gpu",{nodes:n,materials:a}=g(f),[{z:c}]=y({z:r?N+e:e,config:x},[r]),u=m.exports.useRef(null);return D(()=>{u.current.rotation.y+=.01+1/E.state.context.interval}),i(w.group,{name:"gpu",onClick:p=>{p.stopPropagation(),d.play(r?"attach":"remove"),t({type:"VIEW_MODULE",module:r?null:"gpu"})},"position-x":.003,"position-y":-.076,"position-z":c,children:[s(B,{castShadow:!0,receiveShadow:!0,meshes:[n.Cube002,n.Cube002_1,n.Cube002_2],children:(p,S,M)=>i(A,{children:[s(p,{material:n.Cube002.material}),s(S,{material:n.Cube002_1.material}),s(M,{material:n.Cube002_2.material})]})}),s("mesh",{castShadow:!0,receiveShadow:!0,name:"gpu-fan",ref:u,geometry:n.gpu_fan.geometry,material:a.light_metal,position:[.0675,.015,.001]}),r&&s(L,{name:"gpu",description:De})]})},He=`
Speeds up the game clock for the virus.
`,Ve=()=>{const[e,o]=v(),t=e.context.viewedModule==="cpu",{nodes:r,materials:n}=g(f),[{z:a}]=y({z:t?N+.037:.037,config:x},[t]),[{z:c}]=y({z:t?.06:.012,config:x},[t]),u=m.exports.useRef(null);return D(()=>{u.current.rotation.z+=.01+1/E.state.context.interval*.01}),i(A,{children:[s(w.mesh,{castShadow:!0,receiveShadow:!0,name:"cpu",geometry:r.cpu.geometry,material:r.cpu.material,"position-x":0,"position-y":0,"position-z":c}),i(w.group,{name:"cpu-cooler",raycast:de,onClick:p=>{p.stopPropagation(),d.play(t?"attach":"remove"),o({type:"VIEW_MODULE",module:t?null:"cpu"})},"position-x":0,"position-y":0,"position-z":a,children:[s("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.Cube011.geometry,material:r.Cube011.material}),s("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.Cube011_1.geometry,material:n.sand}),s("mesh",{name:"cpu-fan",castShadow:!0,receiveShadow:!0,ref:u,geometry:r.cpu_fan.geometry,material:n.brown,position:[0,0,.01]}),t&&s(L,{name:"cpu",description:He})]})]})};var je="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}",We="uniform float time;varying vec2 vUv;void main(){vec3 rgb=0.5+0.5*cos(time+vUv.xyx+vec3(0,2,4));gl_FragColor=vec4(rgb,1.0);}";const $e=pe({time:0},je,We);ue({RamMaterial:$e});const Be=`
Results in faster cooldowns when assigning units.
`,Fe=()=>{const[e,o]=v(),t=e.context.viewedModule==="ram",{nodes:r,materials:n}=g(f),[{z:a}]=y({z:t?N+.047:.047,config:x},[t]),c=m.exports.useRef(null);return D(()=>{c.current.uniforms.time.value+=.01}),i(w.group,{onClick:u=>{u.stopPropagation(),d.play(t?"attach":"remove"),o({type:"VIEW_MODULE",module:t?null:"ram"})},"position-x":.068,"position-y":.013,"position-z":a,children:[s("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.Cube009.geometry,material:r.Cube009.material}),s("mesh",{castShadow:!0,receiveShadow:!0,geometry:r.Cube009_1.geometry,material:r.Cube009_1.material}),s("mesh",{castShadow:!0,geometry:r.Cube009_2.geometry,material:n.red,children:s("ramMaterial",{ref:c,attach:"material",color:"hotpink"})}),t&&s(L,{name:"ram",description:Be})]})},Ge=`
allows additional units to be built.
`,Ke=()=>{const[e,o]=v(),t=e.context.viewedModule==="ssd",{nodes:r}=g(f),[{z:n}]=y({z:t?N+.016:.016,config:x},[t]);return s(w.mesh,{name:"ssd",castShadow:!0,receiveShadow:!0,onClick:a=>{a.stopPropagation(),d.play(t?"attach":"remove"),o({type:"VIEW_MODULE",module:t?null:"ssd"})},geometry:r.ssd.geometry,material:r.ssd.material,"position-x":0,"position-y":.062,"position-z":n,children:t&&s(L,{name:"ssd",description:Ge})})};g.preload(f);const Ze=o=>{var e=$(o,[]);const{nodes:t,materials:r}=g(f),n=[t.motherboard,t.io,t.motherboard_gpu_io,t.motherboard_cpu_io,t.ram_io];return i("group",U(_({},e),{dispose:null,children:[s(B,{castShadow:!0,receiveShadow:!0,meshes:n,children:(a,c,u,p,S)=>i(A,{children:[s(a,{name:"motherboard",material:r.green}),s(c,{name:"io",material:t.io.material,position:[-.092,.014,.032]}),s(u,{name:"motherboard_gpu_io",material:t.motherboard_gpu_io.material,position:[-.044,-.077,.009]}),s(p,{name:"motherboard_cpu_io",material:r.white,position:[0,0,.005]}),s(S,{name:"ram_io",material:t.ram_io.material,position:[.078,.013,.008]})]})}),s(Pe,{}),s(Oe,{}),s(Fe,{}),s(Ve,{}),s(Ke,{})]}))};me({frustum:1.75,size:.005,near:2.5,samples:30,rings:11});const qe=()=>{const e=1,{tier:o,gpu:t=""}=he(),r=m.exports.useMemo(()=>o<2&&/apple (gpu|m1)/i.test(t)===!1,[o,t]);return i(A,{children:[r&&s(ge,{}),s("ambientLight",{intensity:.1}),s("directionalLight",{castShadow:!0,position:[1,1,1],intensity:2,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048,"shadow-camera-far":25,"shadow-camera-left":-e,"shadow-camera-right":e,"shadow-camera-top":e,"shadow-camera-bottom":-e,onUpdate:n=>n.lookAt(0,0,0)}),s("spotLight",{intensity:.5,position:[-5,10,2],angle:.2,penumbra:1,"shadow-mapSize":[2048,2048],onUpdate:n=>n.lookAt(0,0,0)}),s("rectAreaLight",{color:"red",intensity:.3,position:[1.5,-1,3],width:10,height:10,onUpdate:n=>n.lookAt(0,0,0)})]})};d.create("click",new URL("/game-off-2021/assets/click.359c8c98.wav",self.location).href);d.create("attach",new URL("/game-off-2021/assets/attach.3ec71000.wav",self.location).href);d.create("remove",new URL("/game-off-2021/assets/remove.34b2a270.wav",self.location).href);d.create("track1",new URL("/game-off-2021/assets/track_1.b374b942.mp3",self.location).href);const Je=()=>(m.exports.useEffect(()=>{document.addEventListener("click",()=>{d.loop("track1")},{once:!0})},[]),i("div",{className:"h-screen w-screen",children:[s(m.exports.Suspense,{fallback:null,children:i(ve,{shadows:!0,mode:"concurrent",performance:{min:.7},dpr:Math.min(1.5,window.devicePixelRatio),gl:{alpha:!1,antialias:!1},camera:{position:new fe(.25,.15,.25)},children:[s(ye,{pixelated:!0}),s(we,{}),s(Ie,{}),s(be,{enablePan:!1,enableZoom:!1,enableRotate:!0}),s(qe,{}),s(Ze,{})]})}),s(Ae,{})]}));xe.render(s(m.exports.StrictMode,{children:s(Je,{})}),document.getElementById("root"));
